datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./erd.png"
}

model Professor {
  id        String   @id @default(uuid())
  nome      String
  matricula String   @unique

  turmas     Turma[]
  faceVector FaceVector[]
  Recursos  ReservaRecurso[]
}

model Curso {
  id         Int         @id @default(autoincrement())
  nome       String
  codCurso   String      @unique
  disciplinas Disciplina[]
}

model Disciplina {
  id        Int      @id @default(autoincrement())
  nome      String
  codCred   String   @unique
  cursoId   Int
  curso     Curso    @relation(fields: [cursoId], references: [id])
  turmas    Turma[]
}

model Turma {
  id           Int         @id @default(autoincrement())
  numero       Int         @unique
  horario      String    # horário fixo da turma
  dataInicial  DateTime  # Primeiro dia de aula
  dataFinal    DateTime  # Último dia de aula
  professorId  String
  disciplinaId Int

  professor   Professor   @relation(fields: [professorId], references: [id])
  disciplina  Disciplina  @relation(fields: [disciplinaId], references: [id])
  reservas    ReservaRecurso[]
}

model Recurso {
  id          String  @id @default(uuid())
  descricao   String
  reservado   Boolean  @default(false)
  Sala      Sala?
  reservas  ReservaRecurso[]
}

model Sala {
  id         String   @id
  numeroSala String
  estado     Boolean  @default(false)
  recurso    Recurso @relation(fields: [id], references: [id])
}

model ReservaRecurso {
  id           String         @id @default(uuid())
  professorId  String
  turmaId      Int
  recursoId    String
  periodo      PeriodoLetivo
  data         DateTime

  professor    Professor       @relation(fields: [professorId], references: [id])
  turma        Turma           @relation(fields: [turmaId], references: [id])
  recurso      Recurso         @relation(fields: [recursoId], references: [id])

  @@unique([professorId, turmaId, recursoId, data, periodo])
}

model FaceVector {
  id          String    @id @default(uuid())
  value       Float
  index       Int
  professorId String
  professor   Professor @relation(fields: [professorId], references: [id])

  @@unique([professorId, index])
}

enum PeriodoLetivo {
  AB  // 08:00–09:30
  CD  // 09:45–11:15
  EE1 // 11:30–13:00
  FG  // 14:00–15:30
  HI  // 15:45–17:15
  JK  // 17:30–19:00
  LM  // 19:15–20:45
  NP  // 21:00–22:30
}
